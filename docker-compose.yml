version: '3'

# Do not forget to 'docker network create nginx-proxy' before launch, and to add '--network nginx-proxy' to proxied containers. 
# networks:
#   default:
#     external:
#       name: nginx-proxy

services:

  traefik:
    image: traefik:alpine
    container_name: traefik-proxy
    restart: always
    hostname: traefik
    ports:
      - 80:80
      - 443:443
      - 8080:8080
    volumes:
      - ${PWD}/traefik/traefik.toml:/etc/traefik/traefik.toml
      - ${PWD}/traefik/rules:/rules
      - ${PWD}/traefik/acme.json:/acme.json
      - /var/run/docker.sock:/var/run/docker.sock:ro

  openvpn:
    cap_add:
      - NET_ADMIN
    image: kylemanna/openvpn
    container_name: openvpn
    ports:
      - 1194:1194/udp
    restart: always
    volumes:
      - ${PWD}/openvpn/data/conf:/etc/openvpn

  squid:
    image: sameersbn/squid:latest
    container_name: squid_proxy
    restart: always
    ports:
      - 3128:3128
    volumes:
      - ${PWD}/squid/cache:/var/spool/squid3
      - ${PWD}/squid/squid.conf:/etc/squid3/squid.conf